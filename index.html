<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Pagework Mod Menu</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    /* Hacker vibe */
    body {
      background: #181a1b;
      color: #39ff14;
      font-family: 'Fira Mono', 'Consolas', monospace;
      margin: 0;
      min-height: 100vh;
    }
    #modMenu {
      position: fixed;
      top: 40px;
      right: 40px;
      background: rgba(20, 20, 20, 0.98);
      border: 2px solid #39ff14;
      border-radius: 10px;
      padding: 20px 24px;
      z-index: 9999;
      min-width: 240px;
      box-shadow: 0 0 30px #39ff14a0;
      transition: box-shadow 0.2s;
    }
    #modMenu h2 {
      margin-top: 0;
      color: #39ff14;
      font-size: 1.3em;
      letter-spacing: 2px;
      text-shadow: 0 0 3px #39ff14b0;
      margin-bottom: 15px;
    }
    #modMenu label {
      display: flex;
      align-items: center;
      margin: 8px 0;
      cursor: pointer;
      font-size: 1em;
    }
    #modMenu input[type="checkbox"] {
      accent-color: #39ff14;
      margin-right: 10px;
      width: 18px;
      height: 18px;
    }
    #modMenu .loading {
      color: #888;
      font-size: 0.95em;
      margin: 10px 0;
      text-align: center;
    }
    #modMenu .error {
      color: #f44336;
      font-size: 0.98em;
      margin: 10px 0;
    }
    #modMenuToggle {
      position: fixed;
      top: 40px;
      right: 40px;
      background: #181a1b;
      border: 2px solid #39ff14;
      color: #39ff14;
      font-family: inherit;
      font-size: 1.1em;
      border-radius: 50%;
      width: 48px;
      height: 48px;
      z-index: 10000;
      cursor: pointer;
      box-shadow: 0 0 10px #39ff14a0;
      transition: background 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    #modMenuToggle:hover {
      background: #232826;
    }
  </style>
</head>
<body>
  <button id="modMenuToggle" title="Show/Hide Mod Menu">â˜°</button>
  <div id="modMenu" style="display:none;">
    <h2>Mod Menu</h2>
    <div class="loading">Loading pagework.user.js...</div>
  </div>

  <script>
    // Hacker "glitch" animation for menu open/close (optional)
    function glitchEffect(el) {
      el.style.boxShadow = "0 0 60px #39ff14f0, 0 0 15px #fff";
      setTimeout(() => {
        el.style.boxShadow = "0 0 30px #39ff14a0";
      }, 150);
    }

    // Menu toggle logic
    const menu = document.getElementById('modMenu');
    const toggleBtn = document.getElementById('modMenuToggle');
    toggleBtn.addEventListener('click', () => {
      menu.style.display = menu.style.display === 'none' ? 'block' : 'none';
      glitchEffect(menu);
    });

    // Helper: auto-detect exported features (functions/booleans) from pagework.user.js
    function detectFeatures(obj) {
      if (!obj) return [];
      return Object.entries(obj)
        .filter(([key, val]) =>
          typeof val === 'function' || typeof val === 'boolean'
        )
        .map(([key, val]) => ({
          name: key,
          type: typeof val,
          value: val
        }));
    }

    // Core: dynamically load and inject pagework.user.js
    function injectUserScript(src, onload, onerror) {
      const script = document.createElement('script');
      script.src = src;
      script.type = 'text/javascript';
      script.async = true;
      script.onload = onload;
      script.onerror = onerror;
      document.head.appendChild(script);
    }

    // Try to load as window.pagework, exports, or look for global functions
    function getExports() {
      if (window.pagework) return window.pagework;
      if (window.exports) return window.exports;
      // Fallback: scan window for functions starting with 'pw_' (as example)
      const keys = Object.keys(window).filter(k => k.startsWith('pw_') && typeof window[k] === 'function');
      const fallback = {};
      keys.forEach(k => fallback[k] = window[k]);
      return fallback;
    }

    // Menu population logic
    function renderModMenu(features) {
      const menu = document.getElementById('modMenu');
      menu.innerHTML = `<h2>Mod Menu</h2>`;
      if (!features.length) {
        menu.innerHTML += `<div class="error">No mod features detected ðŸ˜¢</div>`;
        return;
      }
      features.forEach(f => {
        const id = 'mod-' + f.name;
        menu.innerHTML += `
          <label>
            <input type="checkbox" id="${id}" ${f.type === 'boolean' && f.value ? 'checked' : ''}>
            ${f.name}
          </label>
        `;
      });
      // Add handlers for toggling features
      features.forEach(f => {
        const id = 'mod-' + f.name;
        const input = document.getElementById(id);
        input.addEventListener('change', e => {
          const exports = getExports();
          if (f.type === 'function') {
            // Call the function on toggle (enable = checked, disable = unchecked)
            if (typeof exports[f.name] === 'function') {
              try {
                exports[f.name](e.target.checked);
              } catch (err) {
                alert('Error toggling feature: ' + f.name);
              }
            }
          } else if (f.type === 'boolean') {
            // Set the value
            exports[f.name] = e.target.checked;
          }
        });
      });
    }

    // Start: inject pagework.user.js
    const userScriptURL = './pagework.user.js'; // Adjust path if needed!

    injectUserScript(
      userScriptURL,
      () => {
        // Wait a moment for script to register globals
        setTimeout(() => {
          const exports = getExports();
          const features = detectFeatures(exports);
          renderModMenu(features);
        }, 300);
      },
      () => {
        menu.innerHTML = `<h2>Mod Menu</h2><div class="error">Failed to load pagework.user.js</div>`;
      }
    );
  </script>
</body>
</html>
